# MATLAB Post-Processing for Modal NEB Analysis

This folder contains MATLAB scripts for **batch post-processing and scientific visualization** of modal NEB (Nudged Elastic Band) simulation outputs, particularly for analyzing modal contributions to ion migration in complex solids.

**Author:** Kiarash Gordiz  
**Contact:** [your email or link]  

---

## Overview

These MATLAB scripts are designed for automated batch processing and advanced analysis of data generated by the Python-based `modalNEB` package.  
The main script reads simulation outputs from multiple folders, calculates physics-motivated properties, and generates publication-quality figures.  
It is highly adaptable and can be customized for new simulation folders, naming conventions, or analysis requirements.

---

## References

The workflow and theoretical formulations are detailed in:

- [A modal analysis of lithium diffusion in solid electrolytes](https://www.sciencedirect.com/science/article/pii/S2666386421001260), *Cell Reports Physical Science* (2021)
- [A general atomistic framework for computing modal contributions to migration barriers](https://arxiv.org/abs/2305.01632), *arXiv preprint* (2023)

If you use this code in your work, please cite the above publications.

---

## Workflow

1. **Prepare Input Data**
    - Each simulation (hopping event) should be stored in its own folder (e.g., `10_4La_4Li_hop1_00_to_04`).
    - Each folder must include required files:
        - `ev.txt`: Eigenvectors
        - `phonon_contribs_discrete_LLTO.txt`: Frequency and modal contribution data
        - `hopping_atom.txt`, `hopping_pathway.txt`
        - `MB.txt`, `bn_modal_percent_wo_abs.txt`, `Secondary_forces.txt`
    - Update the `foldernames` variable in the script to match your folder names, or place all folders in the same directory as the script.

2. **Run the Script**
    - Open the main `.m` file in MATLAB.
    - Run the script. All post-processing and plotting is automated.

3. **Review Output**
    - Figures appear in MATLAB for immediate review and can be exported.
    - All relevant modal, elemental, and energy-resolved contributions are computed.
    - Example output includes:
        - Migration barrier histograms
        - Mode-resolved contributions
        - Element-resolved energy projections
        - DOS and cumulative plots

---

## Code Style & Automation

- **Batch Automation:**  
  The script is written to process *all* simulation folders in the `foldernames` array in a loop.  
  No manual editing is needed beyond folder list and basic input setup.

- **Self-Contained:**  
  All constants, color schemes, and plot formatting are defined within the script for reproducibility.

- **Flexible Variable Naming:**  
  Major variables used (by convention):
    - `foldernames`: List of all input data folders (update as needed)
    - `freq`: Frequency array (THz)
    - `contrib_to_indi_hop`: Modal contributions to ion migration
    - `powLa`, `powLi`, `powTi`, `powO`: Projected mode amplitudes for each atom type
    - `tagOctRot`: Boolean flag for octahedral rotation modes (from symmetry/criteria)
    - `MB`, `MB_symbol`: Migration barrier and classification
    - Additional arrays for accumulations, sorting, and projections (see code comments for specifics)

- **Reproducible Figures:**  
  All figures use explicit axis scaling, color mapping, and labeling for direct use in publications or presentations.

- **Heavily Commented:**  
  Sections are labeled and many intermediate calculations are explained, to facilitate modification and re-use.

---

## Key Sections & Variables

- **Data Import:**  
  Automatically loads all relevant output files from each simulation folder.
- **Elemental Projections:**  
  Calculates and stores per-atom and per-element projections for each mode.
- **Octahedral Rotation Tagging:**  
  Detects and tags octahedral rotation-related phonon modes based on projection and frequency criteria.
- **Migration Barrier Analysis:**  
  Collates, plots, and bins migration barriers for all pathways/folders.
- **Contribution and Accumulation:**  
  Sorts and accumulates modal contributions, supporting different weighting and normalization schemes.
- **Visualization:**  
  Generates a variety of 2D and 3D figures:
    - MB histograms (with/without Boltzmann weighting)
    - Modal contribution “surf” plots
    - Scatter plots color-coded by atomic projection, frequency, force, or MB
    - DOS and accumulation plots for element-resolved and mode-resolved analysis

---

## How to Adapt/Extend

- **Add new folders:**  
  Update the `foldernames` variable or automate folder discovery using MATLAB functions (e.g., `dir()`).
- **Analyze new properties:**  
  Add new sections, following the existing style for projections/accumulations.
- **Export results:**  
  Add `saveas()`, `exportgraphics()`, or data export commands to store results for later use.

---

## Requirements

- MATLAB R2018b or later recommended.
- No special toolboxes required (uses built-in MATLAB plotting and matrix ops).
- Large RAM may be helpful for high-throughput/batch datasets.

---

## Example Usage

```matlab
% In MATLAB:
cd analysis/matlab/
run('your_postprocessing_script.m')
